{% extends 'admin/admin_base.html.twig' %}

{% block title %}Transaction #{{ transaction.id }}{% endblock %}

{% block body %}
    <div class="max-w-4xl mx-auto mt-10 p-6 bg-white rounded-2xl shadow-md">
        <h1 class="text-3xl font-bold mb-6">Transaction #{{ transaction.id }}</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div><span class="font-semibold">User:</span> {{ transaction.user.email ?? 'N/A' }}</div>
            <div>
                <span class="font-semibold">Wallet:</span>
                <a href="{{ path('app_wallet_show', {'id': transaction.wallet.id}) }}" class="text-blue-600 hover:underline">
                    {{ transaction.wallet.publicAddress ?? 'N/A' }}
                </a>
            </div>

            <div><span class="font-semibold">Crypto Currency:</span> {{ transaction.cryptoCurrency.code ?? 'N/A' }}</div>
            <div><span class="font-semibold">Tx Hash:</span> {{ transaction.txHash }}</div>

            <div><span class="font-semibold">Crypto Amount (Requested):</span> {{ transaction.amountCrypto }}</div>
            <div><span class="font-semibold">Crypto Amount (Received):</span> {{ transaction.receivedAmountCrypto }}</div>

            <div><span class="font-semibold">Is Automatic:</span> {{ transaction.isAutomatic ? 'Yes' : 'No' }}</div>

            <div><span class="font-semibold">Main Status:</span> {{ transaction.mainStatus.name ?? 'N/A' }}</div>
            <div><span class="font-semibold">Manual Status:</span> {{ transaction.manualStatus.name ?? 'N/A' }}</div>
            <div><span class="font-semibold">Automatic Status:</span> {{ transaction.automaticStatus ? transaction.automaticStatus.name : '—' }}</div>

            <div><span class="font-semibold">Confirmation:</span> {{ transaction.confirmation ? transaction.confirmation.status : '—' }}</div>

            <div><span class="font-semibold">Expired At:</span> {{ transaction.expiredAt ? transaction.expiredAt|date('Y-m-d H:i:s') : '—' }}</div>
            <div><span class="font-semibold">Created At:</span> {{ transaction.createdAt ? transaction.createdAt|date('Y-m-d H:i:s') : '—' }}</div>
        </div>

        {# Новий блок: фіатні валюти #}
        <div class="mt-8">
            <h2 class="text-xl font-semibold mb-4">Fiat Amounts</h2>
            {% if transaction.fiatAmounts is empty %}
                <p class="text-gray-500">No fiat amounts associated.</p>
            {% else %}
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left border border-gray-300 rounded-lg">
                        <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-2">Currency</th>
                            <th class="px-4 py-2">Amount</th>
                            <th class="px-4 py-2">Rate</th>
                            <th class="px-4 py-2">Created At</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for fiat in transaction.fiatAmounts %}
                            <tr class="border-t">
                                <td class="px-4 py-2">{{ fiat.fiatCurrency.code }}</td>
                                <td class="px-4 py-2">{{ fiat.amount }}</td>
                                <td class="px-4 py-2">{{ fiat.rate }}</td>
                                <td class="px-4 py-2">{{ fiat.createdAt|date('Y-m-d H:i:s') }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>

        <div class="flex items-center gap-4 mt-8">
            <a href="{{ path('app_transaction_index') }}" class="text-blue-600 hover:underline">← Back to list</a>
            <a href="{{ path('app_transaction_edit', {'id': transaction.id}) }}" class="text-yellow-600 hover:underline">✎ Edit</a>
            {{ include('admin/transaction/_delete_form.html.twig') }}
        </div>
    </div>
{% endblock %}